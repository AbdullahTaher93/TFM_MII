In a blender, combine the chipotles with the ketchup, maple syrup, broth and allspice and puree until smooth. In a medium saucepan, heat the oil until shimmering. Add the onion and garlic and cook over moderately high heat until golden, 5 minutes. Add the chipotle puree. Season with salt and pepper. Cook over moderate heat until thickened, 15 minutes. Stir in the lemon juice. Transfer to a bowl and let cool.