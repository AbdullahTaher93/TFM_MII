In a large pot, cook the bacon over moderate heat until crisp. Remove. Pour off all but 2 tablespoons of the fat. Add the carrots, onions, celery, mushrooms, and garlic. Cook, stirring occasionally, until the vegetables start to soften, about 5 minutes. Add the lentils, broth, water, rosemary, tomatoes, salt, red-pepper flakes, black pepper, and bacon. Bring to a boil. Reduce the heat and simmer for 15 minutes. Add the pasta and simmer until the lentils are tender and the pasta is done, 10 to 15 minutes longer.