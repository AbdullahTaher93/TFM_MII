Heat butter in a saucepan over medium heat; cook and stir onion and celery until tender, about 10 minutes. Add broth, potatoes, salt, rosemary, thyme, and black pepper; stir to combine. Bring to a boil, reduce heat, and simmer until potatoes are tender, 15 to 20 minutes. Whisk flour and 1/2 cup milk together in a bowl until smooth; gradually stir into soup. Bring to a boil, stirring occasionally, until combined, 2 minutes. Stir in ham, peas, and remaining 2 cups milk; cook until heated through, about 5 minutes.