Heat the butter in a large stock pot over medium heat. Cook and stir celery, onion, carrot, and garlic until the onion is translucent. Stir in potatoes, chicken stock, cayenne, thyme, and parsley. Bring to a boil, then cover and reduce heat. Simmer until the potatoes are tender, about 15 minutes. Mix the egg and flour together in a bowl using a fork until the mixture resembles grains of rice. Stir ham and milk into the stock pot and allow the soup to return to a simmer. Slowly sprinkle the dumpling mixture into the soup, stirring constantly to prevent clumps. Simmer for 10 minutes, stirring occasionally. Stir in broccoli and Cheddar cheese. Cook until the broccoli is tender and the Cheddar cheese is melted, about 5 minutes. Season with salt and pepper.