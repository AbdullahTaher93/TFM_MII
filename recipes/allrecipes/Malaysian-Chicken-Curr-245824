Combine shallots, chile peppers, lemongrass, almonds, cilantro, garlic, ginger, and 2 tablespoons peanut oil in a food processor; pulse into a smooth paste. Measure out 1 cup of paste into a large bowl. Add chicken thighs and mix until thoroughly coated. Heat 1 tablespoon peanut oil in a large, deep skillet over medium heat. Pan-fry chicken in batches until cooked through and no longer pink in the center, about 5 minutes. Transfer to a large plate using a slotted spoon; set aside. Place onion, red bell pepper, yellow bell pepper, orange bell pepper, and carrot in the same skillet. Cook and stir until softened, about 5 minutes. Add snow peas; cook and stir until slightly softened but still crisp, about 1 minute. Return chicken to the skillet. Stir in coconut milk, sugar, and salt. Simmer until flavors combine, 10 to 15 minutes.