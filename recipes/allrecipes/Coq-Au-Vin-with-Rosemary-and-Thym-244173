Cook and stir bacon in a large, deep skillet over medium-high heat until evenly browned, about 10 minutes. Transfer bacon to a paper towel-lined plate, reserving bacon grease in skillet. Place chicken thighs in the bacon grease and cook until browned, 2 to 3 minutes per side. Add shallots, thyme, rosemary, and garlic; cook and stir until fragrant, about 1 minute. Sprinkle bacon over chicken mixture and pour in wine; simmer until wine is slightly reduced, 1 to 2 minutes. Add mushrooms and enough chicken stock to almost cover chicken. Cover skillet and simmer for 35 minutes; taste broth and adjust seasoning. Simmer until chicken is no longer pink near the bone, about 10 minutes more. An instant-read thermometer inserted into the center should read at least 165 degrees F (74 degrees C). Melt butter in a saucepan over medium heat; stir in flour and cook until a thick paste forms, about 1 minute. Whisk paste into chicken mixture until sauce is thickened, 1 to 2 minutes.