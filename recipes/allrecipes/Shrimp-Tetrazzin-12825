Cook spaghetti in a large pot of boiling salted water until al dente. Drain well. Over a medium-low heat melt butter in a medium saucepan. Add onion to melted butter and stir until onion is soft. Add shrimp and mushrooms, cook for 5 minutes stirring often. Remove shrimp mixture from saucepan, place in a medium size bowl and set aside. Remove saucepan from heat. Combine flour, mayonnaise, salt, milk, and sherry in the saucepan. Mix well. Return the saucepan to the heat and cook until sauce thickens. Pour sauce into the bowl containing the shrimp mixture. Add the spaghetti to the bowl and mix well. Place all ingredients in a 1-1/2 quart casserole dish (baking pan). Sprinkle the parmesan cheese on top of the mixture. Bake at 350 degrees F (175 degrees C) for 30 minutes.