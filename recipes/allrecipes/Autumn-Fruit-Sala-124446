In a saucepan, combine sugar and flour. Stir in water; bring to a boil. Cook and boil until mixture thickens. Remove from the heat; stir in butter and vanilla. Cool to room temperature. In a large bowl, combine apples, grapes, celery and walnuts. Add the dressing and toss gently. Refrigerate until serving.