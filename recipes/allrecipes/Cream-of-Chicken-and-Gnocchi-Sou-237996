Melt butter in a large, heavy saucepan over medium heat; cook and stir onion, celery, carrot, and garlic until softened, 5 to 10 minutes. Stir flour into vegetable mixture; cook and stir until vegetables are evenly coated and flour is fragrant, 3 to 4 minutes. Pour chicken broth, half-and-half, and milk over vegetable mixture; cook and stir until mixture thickens and comes to a boil, about 5 minutes. Reduce heat and stir gnocchi, chicken, and spinach into broth mixture; season with rosemary, salt, black pepper, and nutmeg. Cook soup over low heat until gnocchi become tender, 8 to 10 minutes.