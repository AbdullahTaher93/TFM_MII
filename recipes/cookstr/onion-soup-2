In a large wide pot, melt the butter over medium heat. Add the onions—to keep them from stewing rather than browning, spread them in as close to a single layer as possible. Cook, stirring occasionally, until they are very brown and soft, about 30 minutes; they will need more frequent stirring toward the end. Stir in the wine and bring to a boil, scraping the bottom of the pan vigorously with a wooden spoon to get up all of the browned bits. Continue scraping while pouring in the beef stock. Then pour in the chicken stock. Season with the salt and pepper. Bring to a boil. Lower the heat and simmer for 10 minutes. The soup can be made ahead to this point and refrigerated for up to 3 days. To gratiné, preheat the broiler and, if necessary, return the soup to the simmer. Lay 2 slices of toast in the bottom of each ovenproof bowl or crock, or make two layers of bread in a large earthenware casserole. If using, mix together the Gruyere and Parmesan. Pour the soup over the slices of bread. Sprinkle the cheese mixture evenly over the soup. Or, if using the mozzarella, lay 4 thin slices over the top of each serving or all the slices over the entire contents of the casserole. Place the containers under the broiler for 3 to 4 minutes until bubbling and brown.