Clean the mushrooms with a mushroom brush or paper toweling. Cut off the stems and reserve. Slice the mushroom caps. In a heavy saucepan, boil the stock and mushroom stems over medium heat until reduced by half, about 10 minutes. Add the heavy cream and cook until reduced to 1½ cups, about 15 minutes Strain. In a large bowl, whisk the eggs, then gradually whisk in the milk. Slowly whisk in the hot stock mixture and set aside. In a large skillet, melt 3 tablespoons butter over medium low heat. Add the shallots and garlic and sauté until translucent, about 5 minutes. Add the sliced mushrooms and thyme. Sauté until the mushrooms are lightly browned and their released liquid evaporates, about 10 minutes. Season with salt and pepper. Use the remaining 1 tablespoon butter to lightly grease an 8½ x 14½-inch loaf pan. Line the bottom with a layer of the toasted bread slices. Scoop in half of the mushroom mixture. Cover with another layer of brioche slices, then add the remaining mushroom mixture. Cover with third layer of brioche and slowly pour the egg mixture over all Cover with plastic wrap and refrigerate overnight. Preheat the oven to 350°F. Unwrap the loaf pan and press the bread down into the liquid. Cover the pan with aluminum foil and place in a roasting pan. Pour enough boiling water into the pan to come halfway up the sides of the loaf pan. Bake for about 2 hours until the pudding is set and the top is puffed and browned. (The pudding can be made ahead and reheated.) Cut into slices and serve warm.