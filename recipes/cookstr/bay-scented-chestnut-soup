For fresh chestnuts, bring a saucepan of water to a boil. Cut the chestnuts in half from top to bottom with a sharp chef’s knife. Put them in the freezer for 10 minutes, then drop them into the boiling water, boil 8 minutes, and drain. While they are still hot, pop out the meat by squeezing on each half. The darker brown pellicle surrounding the meat should come off as well. Work quickly, because the cooler they are, the harder they are to shell. If using dried chestnuts, bring a large pot of water to a boil. Add the chestnuts, simmer for 10 minutes, then remove from the heat and let them soak for 1 hour. Vacuum-packed chestnuts can be added straight from the jar. Cook the onion and celery in the butter in a large saucepan over medium heat, stirring often, until they soften, about 5 minutes. Stir in all but ½ cup of the chestnuts, then the broth, cider, thyme, 5 of the bay laurel leaves (or 1 California bay), and vanilla bean. Cover and simmer the soup over very low heat for 45 minutes. Remove and discard the thyme, bay leaves, and vanilla. Puree the soup in 2 batches in a blender (not a food processor) until very smooth. Don’t fill the blender more than half full, and begin blending in quick pulses to prevent the hot soup from splashing out. Pour the soup back into the saucepan, stir in the cream and sherry, and reheat it to the simmering point. Taste and add as much salt and pepper as you think it needs (if you used canned salted broth you may need very little). Stir in the remaining 5 bay laurel leaves (or 1 California bay) and steep for at least 5 minutes to perfume the soup. Cook the bacon in a medium skillet until it renders out most of its fat but is not quite crisp. Tip the skillet to drain off the excess fat. Dice the reserved ½ cup chestnuts, add them to the bacon, and cook for another minute. Add the apple and cook until warmed through. Remove and discard the bay leaves. Ladle the soup into warm bowls and put a spoonful of the apple-chestnut garnish in the center of each.