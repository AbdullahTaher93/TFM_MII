In a medium, heavy-bottomed saucepan, melt the butter over medium heat. Add the onion and cook, stirring often, until the onion is dark golden brown, about 10 minutes. Add the wine, stock, and vinegar and bring to a simmer. In a medium bowl, toss the cheese with the flour. A handful at a time, stir the cheese into the saucepan, stirring the first addition until melted before adding the next. Allow the fondue to bubble lightly a few times, but do not bring to a boil. Stir in the Cognac and thyme. Season with the pepper. Transfer the fondue to a cheese fondue pot and keep warm over a fondue burner. Serve immediately, with dipping ingredients of your choice.