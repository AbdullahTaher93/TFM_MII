Preheat the oven to 400°F. Fit a food processor with a medium grating blade. With the motor running, alternate pushing the potato and onion chunks through the feed tube. Transfer the mixture to a dish towel-lined colander. Wrap the mixture in the towel and squeeze out as much excess liquid as possible. In a large bowl, whisk together the eggs, flour, ¼ cup oil, salt, pepper, rosemary, and garlic. Heat 1 tablespoon of the remaining oil in a 9-inch, slope-sided skillet. Add the shallots in a single layer over high heat. Let sit several minutes before stirring. Continue to cook, stirring occasionally, until the shallots are crispy and dark brown, about 7 minutes total. Fold the potato mixture and shallots in the egg mixture. Return the skillet to high heat and add the remaining 3 tablespoons oil. Tilt the skillet to grease the bottom and sides of the pan. Carefully press the potato mixture into the pan. Cook over high heat for 3 minutes (this will help sear the bottom crust of the kugel). Transfer the pan to the oven and bake until the potatoes are tender and the top of the kugel is golden brown, 1 to 1¼ hours. Place the kugel under the broiler for 1 to 2 minutes to form a crisp crust on top (watch carefully to see that it does not burn). Run an offset spatula around the edges and bottom of the kugel and carefully invert it onto a large plate or platter. Sprinkle with salt and serve.