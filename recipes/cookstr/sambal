Place the tomatoes in a small pot, cover with water, and bring to a boil over high heat. Cook for 3 minutes, then gently remove the tomatoes with a slotted spoon (keep the water in the saucepan). Run the tomatoes under cold water to stop the cooking and loosen the skins. Peel off skins, cut the tomatoes open, scoop out and discard the seeds, and place the tomatoes in a food processor fitted with the chopping blade. Bring the water in the saucepan back to a boil over high heat and make the chiles take a dive. Boil for 5 minutes. Transfer the chiles to the food processor. (You can discard the water in the pan now.) Add the shallots and garlic to the food processor. Lock on the lid and process until pasty but still a little grainy, scraping down the sides of the canister as necessary. Turn the vent on so the chile oils won’t bowl you over-or open a kitchen window and get a fan blowing through the area. Heat a large skillet over medium heat, then add the oil. Tip and tilt the skillet so its bottom is thoroughly coated, then add all the chile paste from the food processor. Fry this paste until exquisitely aromatic and a little thickened, about 5 minutes, stirring almost the whole time. Stir in the water, vinegar, brown sugar, and salt. Reduce the heat a little and continue cooking, stirring often, until all the oil and water have been absorbed and the mixture is a fiery, thick condiment, about like grainy ketchup. Store in a glass container in the refrigerator for up to 2 months. (The sambal actually tastes best if it’s allowed to ripen a few days before using.)