Melt the butter in a soup pot over medium heat. Add the onions and garlic and sauté, stirring occasionally until well softened and light colored, about 10 minutes. Stir in the tomatoes and cilantro and sauté, stirring frequently, for another 15 minutes. Sprinkle in the flour and cook for another minute, stirring. Gradually stir in the hot stock and let it boil for about 1 minute. Reduce the heat to low, add salt, and simmer, uncovered, for 20 minutes, stirring once or twice. Working in batches, puree the soup in a food processor until smooth. Return the soup to the pot and let it simmer, covered, for about 5 minutes. Remove from the heat. In a bowl, whisk the egg yolks and lemon juice together until well blended. Gradually whisk in about 1 cup of soup until completely smooth. Stir the egg yolk mixture back into the soup. Return the soup to the heat and simmer gently, uncovered, until the soup thickens, 3 minutes. Garnish with fresh parsley and cilantro and serve with plenty of freshly ground black pepper.