Heat oil in a large skillet over medium-high. Cook onions, leeks, and celery, stirring often, until soft but not browned, 6–8 minutes. Season with salt. Preheat oven to 350°F. Toast pistachios on a rimmed baking sheet, tossing once, until golden brown, 6–8 minutes. Let cool; crush using a small saucepan (you want a mix of sizes). Pulse garlic, basil, parsley, and 1/3 cup oil in a food processor until a coarse purée forms. Transfer to a medium bowl and mix with Parmesan, lemon zest, crushed nuts, and remaining 1/3 cup oil; season with salt and pepper. Heat oil in a medium pot over medium-high. Cook thyme, bay leaf, and 1/2 cup soffritto, stirring often, until fragrant, about 2 minutes. (Reserve remaining soffritto for another use.) Add stock and bring to a boil. Reduce heat to a simmer and add sugar snap peas; cook until crisp-tender, about 4 minutes. Add kale, beans, and peas and cook until kale is wilted and peas are tender, about 3 minutes. Taste and adjust seasoning with salt and black pepper. Serve soup, topped with some Parmesan and red pepper flakes, with toast and pesto. Soffritto can be made 3 days ahead. Let cool; cover and chill, or freeze up to 1 month.