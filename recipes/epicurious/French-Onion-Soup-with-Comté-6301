Heat butter in a large heavy pot over medium-high heat. Add onions, shallots, and garlic; season with salt and pepper and cook, stirring occasionally, until softened and dark brown, 60–70 minutes. Add vermouth and vinegar. Bring to a boil, reduce heat, and simmer until slightly reduced, about 3 minutes. Tie parsley, thyme, and bay leaf with kitchen twine; add to pot along with broth. Bring to a boil, reduce heat, and simmer, stirring occasionally, until reduced to about 8 cups, 35–40 minutes; discard herb bundle. Preheat oven to 450°F. Place ovenproof bowls on a large rimmed baking sheet. Divide soup among bowls and top with toasts (cut to fit if necessary) and cheese. Bake until cheese is bubbling and golden brown, 6–8 minutes. DO AHEAD: Soup can be made 2 days ahead. Let cool; cover and chill.