Bring chicken, onion, carrots, celery, and 5 quarts water to a boil in a large heavy pot. Reduce heat and simmer, skimming surface occasionally, until broth is flavorful and reduced by one-fourth, about 2 hours. Strain stock through a fine-mesh sieve into a large bowl; discard solids. (You should have about 4 quarts). Let cool, then cover and chill. DO AHEAD: Stock can be made 5 days ahead. Let cool, then cover and chill. Rub chicken legs with five-spice powder, grated ginger, 1 tablespoon salt, and 1 tablespoon sugar; let sit 15 minutes. Meanwhile, heat broiler. Spread out halved ginger and onions on a rimmed baking sheet and broil, turning occasionally, until charred all over, 15–20 minutes. Add lemongrass, cardamom, star anise, cinnamon, and cloves to onions and ginger and broil until lightly charred and fragrant, about 1 minute. Transfer onion mixture to a large heavy pot. Add chicken stock and fish sauce and bring to a boil. Add seasoned chicken, reduce heat, and simmer until chicken is just cooked through, 20–25 minutes. Using tongs, transfer chicken to a plate. Let cool slightly, then remove skin and bones; discard. Shred meat. Continue to simmer broth until it reduces slightly and flavors concentrate, 50–60 minutes. Season with more salt and/or sugar, if desired. Strain into a large bowl or clean pot. Cook noodles according to package directions. Using tongs or a spider, transfer noodles to a colander and run under cold water to stop cooking; set aside. (Keep pot of boiling water handy for reheating noodles.) Just before serving, return noodle cooking water to a boil. Place noodles in a fine-mesh sieve and lower into hot water to reheat, 30 seconds. Divide noodles among warm bowls and add shredded chicken and bean sprouts. Ladle hot broth over, dividing evenly. Serve with Spicy Pickled Shallots, herbs, and lime wedges for squeezing over. DO AHEAD: Seasoned chicken broth can be made 2 days ahead. Let cool, then cover and chill. Bring to a boil before serving.