Preheat the oven to 180C/360F/Gas 4.Soak the sultanas in a small bowl of warm water for 30 minutes.Place the apples in a medium saucepan with the brown sugar and cook over a low heat until soft. Drain the sultanas and add them to the pan, then add the chopped pistachios and cinnamon. Set aside.In a large bowl, beat together the butter and sugar until pale and fluffy. Beat in the eggs one by one and then fold in the ground almonds. Lightly stir to make a smooth batter.Place the apples in a baking dish and spread the creamed mixture over the top. Cook in the oven for 30 minutes, then sprinkle with the flaked almonds and reserved pistachios. Return to the oven and cook for a further 10 minutes.Serve a wedge of cake with scoop of vanilla ice cream.